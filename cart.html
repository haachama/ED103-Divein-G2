<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./img/favicon.ico" type="image/x-icon" />
    <link rel="Shortcut Icon" href="./img/favicon.ico" type="image/x-icon" />

    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./fontawesome/css/all.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>海中日子 | 購物車</title>
</head>

<body class="cart">
    @@include('./layout/header.html')

    <div class="title">
        <h2>購物車</h2>
    </div>

    <div class="container">
        <div class="wrap">
            <div class="listHeader">
                <h4>商品圖片</h4>
                <h4>商品名稱</h4>
                <h4>單價</h4>
                <h4>數量</h4>
                <h4>小計</h4>
                <h4>刪除</h4>
            </div>
            <!--動態新增開始
             <div class="listRow">
                <div class="prodInfo">
                        <div class="prodPic">
                            <img src="./img/shop/mask4@2x.png" alt="">
                        </div>
                        <div class="prodName">水中看得清</div>
                        <div class="prodPrice">8600</div>
                        <div class="prodNumber">
                            <i class="fas fa-minus"></i>
                            <input type="text" value="1" readonly="readonly" name="number">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="subTotal">17200</div>
                        <div class="trashcan">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                </div>
            動態新增結束 -->
        </div>
        <div id="madaBuy">
            您還沒挑選任何商品，歡迎到商城逛逛唷！
        </div>
        <div class="totalContent">
            <div class="calc">
                <p class="bill">您挑選了<span id="countItems">0</span>項物品，總金額為：$<span id="allTotal">0</span></p>
                <!-- <p class="point">您目前持有點數：<span>100</span></p>
                <p class="total">總計：$<span>34700</span></p> -->
            </div>
        </div>

        <div class="cartBtn">
            <div class="bubbleBtn buyMore">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="goo">
                    <defs>
                        <filter id="goo">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                            <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9"
                                result="goo" />
                            <feComposite in="SourceGraphic" in2="goo" />
                        </filter>
                    </defs>
                </svg>

                <span class="button--bubble__container">
                    <a href="./shop.html"" class=" button button--bubble more">
                        繼續購物
                    </a>
                    <span class="button--bubble__effect-container">
                        <span class="circle top-left"></span>
                        <span class="circle top-left"></span>
                        <span class="circle top-left"></span>
                        <span class="button effect-button"></span>
                        <span class="circle bottom-right"></span>
                        <span class="circle bottom-right"></span>
                        <span class="circle bottom-right"></span>
                    </span>
                </span>
            </div>
            <div class="bubbleBtn thebill">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="goo">
                    <defs>
                        <filter id="goo">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                            <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9"
                                result="goo" />
                            <feComposite in="SourceGraphic" in2="goo" />
                        </filter>
                    </defs>
                </svg>

                <span class="button--bubble__container">
                    <a href="#campaign" class="button button--bubble">
                        進行結帳
                    </a>
                    <span class="button--bubble__effect-container">
                        <span class="circle top-left"></span>
                        <span class="circle top-left"></span>
                        <span class="circle top-left"></span>
                        <span class="button effect-button"></span>
                        <span class="circle bottom-right"></span>
                        <span class="circle bottom-right"></span>
                        <span class="circle bottom-right"></span>
                    </span>
                </span>
            </div>
        </div>
    </div>

    <div class="billSet">
        <section class="writeInfo">
            <div class="information">
                <h3>填寫資料</h3>
                <form class="wrap">
                    <div class="writeInfoCol">
                        <h4>收件人資訊</h4>
                        <p>
                            姓名：
                            <input id="name" type="text">
                        </p>
                        <p>
                            電話：
                            <input type="text">
                            <br>
                            <span class="msg">請輸入09開頭的十位數字</span>
                        </p>
                        <p>
                            地址：
                            <input type="text">
                        </p>
                    </div>
                    <div class="writeInfoCol creditCard">
                        <h4>信用卡付款資訊</h4>
                        <p>
                            信用卡帳號：
                            <input type="text">
                            -
                            <input type="text">
                            -
                            <input type="text">
                            -
                            <input type="text">
                            <span class="msg">請輸入四位數字</span>
                        </p>
                        <p>
                            有效期限：
                            <input type="text">
                            月
                            <input type="text">
                            年
                            <span class="msg">請輸入1-12/20XX</span>
                        </p>
                        <p>
                            安全碼：
                            <input type="text">
                            <span class="msg">請輸入三位數字</span>
                        </p>
                    </div>
                    <div class="subBtn">
                        <div class="bubbleBtn toBack">
                            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="goo">
                                <defs>
                                    <filter id="goo">
                                        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                                        <feColorMatrix in="blur" mode="matrix"
                                            values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo" />
                                        <feComposite in="SourceGraphic" in2="goo" />
                                    </filter>
                                </defs>
                            </svg>

                            <span class="button--bubble__container">
                                <a href="#campaign" class="button button--bubble">
                                    回上一步
                                </a>
                                <span class="button--bubble__effect-container">
                                    <span class="circle top-left"></span>
                                    <span class="circle top-left"></span>
                                    <span class="circle top-left"></span>
                                    <span class="button effect-button"></span>
                                    <span class="circle bottom-right"></span>
                                    <span class="circle bottom-right"></span>
                                    <span class="circle bottom-right"></span>
                                </span>
                            </span>
                        </div>
                        <div class="bubbleBtn sent">
                            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="goo">
                                <defs>
                                    <filter id="goo">
                                        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                                        <feColorMatrix in="blur" mode="matrix"
                                            values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo" />
                                        <feComposite in="SourceGraphic" in2="goo" />
                                    </filter>
                                </defs>
                            </svg>

                            <span class="button--bubble__container">
                                <a href="#campaign" class="button button--bubble">
                                    確認送出
                                </a>
                                <span class="button--bubble__effect-container">
                                    <span class="circle top-left"></span>
                                    <span class="circle top-left"></span>
                                    <span class="circle top-left"></span>
                                    <span class="button effect-button"></span>
                                    <span class="circle bottom-right"></span>
                                    <span class="circle bottom-right"></span>
                                    <span class="circle bottom-right"></span>
                                </span>
                            </span>
                        </div>
                    </div>
                </form>
            </div>
        </section>
    </div>


    <div class="lightbox-block1">
        <div class="lightbox1">
            <div class="button_closeBox1">
                <button type="button" class="btn_modal_close">✖</button>
            </div>
            <div class="confirmContainer">
                <p class="confirmTitle">請確認您的資料</p>
                <p class="confirmTitle">收件人資訊：</p>
                <p>姓名：</p>
                <p>行動電話：</p>
                <p>地址：</p>
                <p class="confirmTitle">信用卡資訊：</p>
                <p>信用卡帳號：</p>
                <p>有效期限：</p>
                <button class="rewrite">重新填寫</button>
                <button class="confirmBtn">確認送出</button>
            </div>
        </div>
    </div>

    @@include('./layout/footer.html')
    <script src="./js/cart.js"></script>
    <script src="./js/bubbleBtn.js"></script>

    <script>
        $(function () {

            // 開啟 Modal 彈跳視窗
            $(".sent").on("click", function () {
                $(".lightbox-block1").addClass("-openbox");
            });

            // 關閉 Modal
            $(".btn_modal_close").on("click", function () {
                $(".lightbox-block1").addClass("-opacity-zero");
                // 設定隔一秒後，移除相關 class
                setTimeout(function () {
                    $(".lightbox-block1").removeClass("-openbox -opacity-zero");
                }, 1000);
            });
        });
    </script>


    <script>
        function doFirst() {
            let billSet = document.getElementsByClassName('billSet')[0];
            document.getElementsByClassName('billSet')[0].style.visibility = 'hidden';
            let thebill = document.getElementsByClassName('thebill')[0];
            thebill.addEventListener('click', appear);
            let cartBtn = document.getElementsByClassName('cartBtn')[0];
            function appear() {
                billSet.style.visibility = 'visible';
                cartBtn.style.visibility = 'hidden';
            }
            let toBack = document.getElementsByClassName('toBack')[0];
            toBack.onclick = function () {
                billSet.style.visibility = 'hidden';
                cartBtn.style.visibility = 'visible';
            }

        }
        window.addEventListener('load', doFirst);
    </script>


    <script>
        var storage = sessionStorage;

        function doFirst() {
            // 抓購物車SPAN
            let itemCounting = document.getElementById('itemCounting');
            // 抓按鈕
            let buyMore = document.getElementsByClassName('more')[0];
            let theBill = document.getElementsByClassName('thebill')[0];
            // 沒買商品時顯示文字資訊
            let madaBuy = document.getElementById('madaBuy');

            let itemString = storage.getItem('addItemList'); //給key值，傳回value
            // alert(itemString); "A1001, A1005, A1006, A1002";
            // substr 返回擷取的字串，四個分隔號會分割成五個值的陣列，故最後的分隔號不計算，就可避免多一個空值
            let items = itemString.substr(0, itemString.length - 2).split(', ');
            // [A1001,A1005,A1006,A1002]
            let newPrice = 0;
            // 使用全域物件
            newlistRow = document.createElement('div');
            newlistRow.className = 'listRow';

            // 購物車右上角數字
            if (storage['addItemList'] == null | storage['addItemList'] == '') {
                itemCounting.style.display = "none";
                theBill.style.display = "none";
                buyMore.innerText = "去逛商城";
            } else {
                itemCounting.style.display = "block";
                itemCounting.style.backgroundColor = "red";
                itemCounting.innerText = items.length;
                madaBuy.style.display = "none";
            }

            // 將table放進section，再將section放進cartList
            document.getElementsByClassName('wrap')[0].appendChild(newlistRow);

            total = 0;

            // 每購買一個品項，就呼叫函數創建
            for (let i = 0; i < items.length; i++) {
                // items[0] = A1001，傳回 value值 Formosa|formosa.jpg|5000
                let itemInfo = storage.getItem(items[i]);

                createlistRow(items[i], itemInfo);

                let itemPrice = parseInt(itemInfo.split('|')[2]);  //value="Formosa|formosa.jpg|5000" 價格的部分
                total += itemPrice;
            }

            // 刪除商品

            let trash = document.querySelectorAll('i.fa-trash');
            for (let i = 0; i < trash.length; i++) {
                trash[i].addEventListener('click', function () {
                    // console.log(trash[i].parentNode.previousSibling.innerText);
                    let productPrice = trash[i].parentNode.previousSibling.innerText;
                    let InfoRow = trash[i].parentNode.parentNode;
                    document.getElementsByClassName('listRow')[0].removeChild(InfoRow);
                    document.getElementById('allTotal').innerText -= parseInt(productPrice);

                    let productID = trash[i].parentNode.previousSibling.previousSibling.previousSibling.previousSibling.id;

                    // // 清除storage的資料
                    storage.removeItem(productID);
                    storage['addItemList'] = storage.getItem('addItemList').replace(`${productID}, `, '');

                    countItems = 0;
                    itemString = storage.getItem('addItemList');
                    // console.log(itemString);
                    items = itemString.substr(0, itemString.length - 2).split(', ');
                    // console.log(items);
                    // console.log(typeof(items));

                    if (storage['addItemList'] == null | storage['addItemList'] == '') {
                        document.getElementById('countItems').innerHTML = 0;
                        itemCounting.style.display = "none";
                        theBill.style.display = "none";
                        madaBuy.style.display = "block";
                        buyMore.innerText = "去逛商城";
                    } else {
                        document.getElementById('countItems').innerHTML = items.length;
                        itemCounting.style.display = "block";
                        itemCounting.style.backgroundColor = "red";
                        itemCounting.innerText = items.length;
                        madaBuy.style.display = "none";
                    }

                    
                })
            }



            document.getElementById('allTotal').innerText = total;

            //加減
            let plus = document.getElementsByClassName('fa-plus');
            let minus = document.getElementsByClassName('fa-minus');
            // for (let p = 0; p < plus.length; p++) {
            //     plus[p].addEventListener('click', plus1);
            // }
            function plus1(e) {
                var nowValue = parseInt(e.target.parentNode.getElementsByTagName('input')[0].value);
                nowValue = ++nowValue;
                e.target.parentNode.getElementsByTagName('input')[0].value = nowValue;
            }
            // for (let m = 0; m < minus.length; m++) {
            //     minus[m].addEventListener('click', minus1);
            // }
            function minus1(e) {
                let nowValue = parseInt(e.target.parentNode.getElementsByTagName('input')[0].value);
                nowValue -= 1;

                if (nowValue < 1) {
                    nowValue = 1;
                }
                e.target.parentNode.getElementsByTagName('input')[0].value = nowValue;
            }



            function createlistRow(itemId, itemValue) {
                newprodInfo = document.createElement('div');
                newprodInfo.className = 'prodInfo';

                newprodPic = document.createElement('div');
                newprodPic.className = 'prodPic';

                newImg = document.createElement('img');

                newprodName = document.createElement('div');
                newprodName.className = 'prodName';

                newprodPrice = document.createElement('div');
                newprodPrice.className = 'prodPrice';

                newprodNumber = document.createElement('div');
                newprodNumber.className = 'prodNumber';

                newfasMinus = document.createElement('i');
                newfasMinus.addEventListener('click', minus1);
                newfasMinus.addEventListener('click', changeItemCount);
                newfasMinus.className = 'fas , fa-minus';

                newprodInput = document.createElement('input');
                newprodInput.type = 'text';
                newprodInput.value = '1';
                newprodInput.min = '0';
                newprodInput.addEventListener('input', changeItemCount);

                newfasPlus = document.createElement('i');
                newfasPlus.addEventListener('click', plus1);
                newfasPlus.addEventListener('click', changeItemCount);
                newfasPlus.className = 'fas , fa-plus';


                newsubTotal = document.createElement('div');
                newsubTotal.className = 'subTotal';

                newtrashcan = document.createElement('div');
                newtrashcan.className = 'trashcan';
                newfas = document.createElement('i');
                newfas.className = 'fas fa-trash';


                let itemTitle = itemValue.split('|')[0];
                let itemImage = './img/shop/' + itemValue.split('|')[1];
                let itemPrice = parseInt(itemValue.split('|')[2]);

                // 建立每個品項的清單區域-----

                newlistRow.appendChild(newprodInfo);



                // 建立商品圖片-----
                newprodInfo.appendChild(newprodPic);
                newprodPic.appendChild(newImg);
                newImg.src = itemImage
                newImg.width = "100%";   //HTMl 屬性不用單位



                // 建立商品名稱-----
                newprodInfo.appendChild(newprodName);
                newprodName.innerText = itemTitle;
                newprodName.id = itemId;

                // 建立商品價格-----
                newprodInfo.appendChild(newprodPrice);
                newprodPrice.innerText = itemPrice;


                // 建立商品數量-----
                newprodInfo.appendChild(newprodNumber);
                newprodNumber.appendChild(newfasMinus);
                newprodNumber.appendChild(newprodInput);
                newprodNumber.appendChild(newfasPlus);

                // newprodNumber.innerText = 1;

                newsubTotal.innerText = itemPrice;
                // 建立商品小計-----td
                newprodInfo.appendChild(newsubTotal);


                // 建立刪除按鈕-----
                newprodInfo.appendChild(newtrashcan);
                newtrashcan.appendChild(newfas);



                countItems = 0;
                document.getElementById('countItems').innerHTML = items.length;

            }

            // 商品數量變數相關
            function changeItemCount() {
                let itemString = storage.getItem('addItemList'); //給key值，傳回value
                // let items = itemString.substr(0, itemString.length - 2).split(', ');
                let prodNumber = this.parentNode;
                let inputN = prodNumber.getElementsByTagName("input")[0]
                let itemId = this.parentNode.previousSibling.previousSibling.id;
                let thisItem = storage.getItem(itemId);  //得到value值
                let itemPrice = parseInt(thisItem.split('|')[2])  //取得每個商品價格
                let subtotal = this.parentNode.nextSibling;
                // console.log(subtotal.innerText);
                newCount = parseInt(inputN.value);
                newPrice = itemPrice * newCount;

                let newPri = 0;
                subtotal.innerText = parseInt(newPrice);
                for (let i = 0; i < document.getElementsByClassName('subTotal').length; i++) {
                    newPri += parseInt(document.getElementsByClassName('subTotal')[i].innerText);
                }
                // console.log(newPri);
                document.getElementById('allTotal').innerText = newPri;
            }

        }
        window.addEventListener('load', doFirst);
    </script>


</body>

</html>