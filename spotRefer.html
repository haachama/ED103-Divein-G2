<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./img/favicon.ico" type="image/x-icon" />
    <link rel="Shortcut Icon" href="./img/favicon.ico" type="image/x-icon" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <link rel="stylesheet" href="fontawesome/css/all.css">
    <link rel="stylesheet" href="css/style.css">
    <title>海中日子｜潛點介紹</title>
    <style>
        header{
            background-color: rgba(22,24,29,0.55);
        }
        #spanLogin:hover{
            cursor: pointer;
        }
        .memCart li{
             color: #fefefe;
        }
        #spotComSend{
            border-radius: 50%;
            overflow: hidden;
        }   
        .spotRefer .spotComSend .spotComSendText .fa-location-arrow{
            top: 30%;
        }
        .spotRefer .spotRefer_right .spotWeatherfuture{
            overflow: auto;

        }
        .spotRefer .spotRefer_left .hereList ul li:last-child::after{
            display: none;
        }
        
        .spotRefer_Contain{
            /* border: 1px solid green; */
            display: flex;
            flex-direction: column;

        }
        .spotReferImg img{
            max-height: 400px;
            object-fit: cover;
        }

        .spotReferSmallImgRows{
            margin-top: 20px;
            width: 100%;
            display: flex;
            flex-direction: row;
            /* border: 1px solid red; */
        }

        .spotReferSmallImg,.spotReferSmallImg_rwd{
            width: 80%;
            margin: 0 auto;
            display: inline-block;
        }

        .spotReferSmallImg img,.spotReferSmallImg_rwd img{
            width: 50px;
            height: 50px;
            object-fit: cover;

        }
        .spotRefer .spotRefer_left .hereList ul li{
            height: 72px;
            overflow: hidden;
            border-radius: 50%;
            padding: 0px;
            margin: 2px;
        }
        .spotRefer .spotRefer_left .hereList ul li img{
            border-radius: 0;
        }

        @media (max-width: 992px){
            .spotRefer .spotRefer_right .spotWeatherTab{
                width: 100%;
            }
            .spotRefer .spotRefer_right .weather_block .weather_block_inside{
                padding: 10px 2px;
            }
            .spotReferSmallImgRows{
                margin-top: 0;
                margin-bottom: 20px;
            }
            .spotReferImg img{
                max-height: 350px;
            }
        }
        @media (max-width: 576px){
            .spotRefer .spotComSend{
                width: 90%;
            }
            .spot .spotData {
                font-size: 12px;
            }
            .spot .spotData ul li{
                font-size: 12px;
            }
            .spot .spotData ul .spotDataNum{
                font-size: 20px;
            }
            .spot .spotPush img {
                height: 50px;
            }
            .spotReferImg img{
                max-height: 224px;
            }
        }
        @media (max-width: 576px){
            .spotReferImg img{
                max-height: 200px;
            }
        }


    </style>
</head>
<body class="spotRefer">
    <header>
        <h1 class="logo">海中日子 Divein
            <a href="./main.html"><img src="./img/header/logo.png" alt="logo"></a>
        </h1>
        <div class="nav">
            <ul>
                <li class="recommend_nav">
                    <a href="./spot.html">潛點推薦</a>
                </li>
                <li class="course_nav">
                    <a href="./course.php">潛水課程</a>
                </li>
                <li class="shop_nav">
                    <a href="./shop.html">潛水商城</a>
                </li>
                <li class="blog_nav">
                    <a href="./diary.html">潛水日誌</a>
                </li>
                <li class="game_nav">
                    <a href="./gameIntro.html">下潛遊戲</a>
                </li>
            </ul>
        </div>
        <div class="memCart">
            <ul>
                <li class="userName"><span id="memName"></span><span id="spanLogin"></span></li>
                <li class="memberIcon">
                    <a id="loginA" href="#"><img src="./img/header/member.png"></a>
                </li>
                <li class="lili">
                    <a class="cartlink" href="./cart.html">
                        <img src="./img/header/cart.png">
                    </a>
                    <span id="itemCounting"></span>
                </li>
            </ul>
        </div>
        <button class="hamburger hamburger--3dxy" type="button">
            <span class="hamburger-box">
                <span class="hamburger-inner"></span>
            </span>
        </button>
    </header>

    <main class="spotRefer_Main">
        <div class="spotReferTitle">
            <h2>潛點介紹</h2>
        </div>

        <div class="spotRefer_Contain_rwd">
            <!-- <h3 data-geocode="10014" data-spotStationId="467660" data-spotStationId_sea="WRA007" ></h3> -->
            <!-- 潛點照片_rwd 串接好了 -->
            <div class="spotReferImg" id="spotReferImg_rwd">

            </div>
            <div class="spotReferSmallImgRows">
                <div class="spotReferSmallImg_rwd" id="spotReferSmallImg_rwd"></div>
            </div>
            <!-- 潛點照片_rwd 串接好了 end-->
        </div>

        <div class="spotReferTab_rwd">
            <ul>
                <li><a href="" class="spotRefrList spotShow" data-target="spotRefer_intor">潛點介紹</a></li>
                <li><a href="" class="spotRefrList" data-target="spotRefer_here">踩點</a></li>
                <li><a href="" class="spotRefrList" data-target="spotRefer_weather">天氣氣象</a></li>
                <li><a href="" class="spotRefrList" data-target="spotRefer_Animal">其他</a></li>
                <li><a href="" class="spotRefrList" data-target="spotRefer_Com">留言區</a></li>
            </ul>
        </div>

        <section class="spotRefer_intor spotShow">
            <!-- 潛點介紹_rwd 串接好了 -->
            <div class="spotReferIntor" id="spotReferIntor_rwd"></div>
            <!-- 潛點介紹_rwd 串接好了 end-->
        </section>

        <section class="spotRefer_here spotRefer_left">
            <div class="spotRefer_Contain">
                <!-- 潛點照片 串接好了 -->
                <div class="spotReferImg" id="spotReferImg">
                    <!-- <img src="./img/spot/spotGiLittle-02.png" alt=""> -->
                </div>
                <div class="spotReferSmallImgRows">
                    <div class="spotReferSmallImg" id="spotReferSmallImg"></div>
                </div>
                <!-- 潛點照片 串接好了 end-->
            </div>

            <div class="spotRefer_left_spotHere" >
                <div id="spotPepSum"></div>

                <div class="spotHereBlock">
                    <div class="hereList">
                        <ul id="spotImgHereList">
                        </ul>
                    </div>
                    <div class="hereAddBtn" id="hereAddBtn">
                        我要<br>踩點
                    </div>
                </div>

            </div>
        </section>
            <!-- 潛點介紹 串接好了 
            綠島<h3 data-geocode="10014" data-spotStationId="467660" data-spotStationId_sea="WRA007" ></h3>
            蘭嶼<h3 data-geocode="10014" data-spotStationId="467620" data-spotStationId_sea="C6S94" ></h3>
            墾丁<h3 data-geocode="10013" data-spotStationId="467590" data-spotStationId_sea="46759A" ></h3>
            小琉球<h3 data-geocode="10013" data-spotStationId="467590" data-spotStationId_sea="46714D" ></h3>
            東北角<h3 data-geocode="65" data-spotStationId="466900" data-spotStationId_sea="46694A" ></h3>
            -->
        <section class="spotRefer_weather spotRefer_right">
            <!-- <h3 data-geocode="10014" data-spotStationId="467660" data-spotStationId_sea="WRA007" ></h3> -->
            
            <!-- 潛點介紹 串接好了 -->
            <div class="spotReferIntor" id="spotReferIntor"></div>
            <!-- 潛點介紹 串接好了 結束-->
            <!-- 天氣 即時跟未來 串接好了 -->
            <div class="spotWeatherTab">
                <div class="weather_list">
                    <ul>
                        <li><a href="" class="weathers -iAmHere" data-target="weatherNow" >即時氣象</a></li>
                        <li><a href="" class="weathers" data-target="weatherFuture" >未來一週</a></li>
                    </ul>
                </div>
                <div class="weather_block weatherNow -iAmHere">
                    <div class="weather_block_inside" id="today"></div>
                    <div class="weather_block_inside">
                        <div class="spotWeatherText spotWeatherText_right">
                            <i class="fas weatherString fa-4x"></i>
                            <h5></h5>
                        </div>
                        <div class="spotWeatherText spotWeatherText_left">
                            <div>
                                <div class="weather_main TEMP">
                                    <h6>氣溫</h6>
                                    <h5></h5>
                                </div>
                                <div class="weather_main WDIR">
                                    <h6>風向</h6>
                                    <h5></h5>
                                </div>
                                <div class="weather_main UV">
                                    <h6>紫外線指數</h6>
                                    <h5></h5>
                                </div>
                            </div>
                            <div>
                                <div class="weather_main sea_tmp">
                                    <h6>海溫</h6>
                                    <h5></h5>
                                </div>
                                <div class="weather_main water">
                                    <h6>浪況</h6>
                                    <h5></h5>
                                </div>
                                <div class="weather_main 24R">
                                    <h6>累積雨量</h6>
                                    <h5></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weather_block weatherFuture">
                    <div class="weather_block_inside" id="weekDay"></div>
                    <div class="weather_block_inside">
                        <div class="spotWeatherfuture" id="spotWeatherfuture"></div>
                    </div>
                </div>
                <div class="weatherDataFrom">
                    <p>資料來源：<a href="https://www.cwb.gov.tw/V8/C/ " target="_blank" >中央氣象局<span id="timeNow"></span></a></p>
                </div>
            </div>
            <!-- 天氣 即時跟未來 串接好了 結束 -->
        </section>

        <section class="spotRefer_Animal">
            <h3>你將會看到．．．</h3>
            <!-- 動物 串好後端資料 -->
            <div class="spotAnimal" id="showAnimalRows"></div>
            <!-- 動物 串好後端 end -->
        </section>
        
        <section class="spotRefer_Com">
            <h3>留言區</h3>
            <!-- 留言 串好後端 -->
            <div class="spotComBlock" id="showComRows"></div>
            <!-- 留言 串好後端 end -->

            <div class="spotComBlock">
                
                <!-- 載入更多 -->
                <div class="bubbleBtn spotComMoreBtn" id="getMsgBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="goo">
                        <defs>
                            <filter id="goo">
                                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9"
                                    result="goo" />
                                <feComposite in="SourceGraphic" in2="goo" />
                            </filter>
                        </defs>
                    </svg>
            
                    <span class="button--bubble__container">
                        <a href="#campaign" class="button button--bubble" id="getMsgBtnText">
                            載入更多
                        </a>
                        <span class="button--bubble__effect-container">
                            <span class="circle top-left"></span>
                            <span class="circle top-left"></span>
                            <span class="circle top-left"></span>
            
                            <span class="button effect-button"></span>
            
                            <span class="circle bottom-right"></span>
                            <span class="circle bottom-right"></span>
                            <span class="circle bottom-right"></span>
                        </span>
                    </span>
                </div>
                <!-- 載入更多 end -->

            </div>

            <div class="lightbox-block3 reportCom">
                <div class="lightbox3">
                    <div class="button_closeBox3">
                        <button type="button" class="btn_modal_close">✖</button>
                    </div>
                    <h3>請問是什麼狀況產生的檢舉呢？</h3>
                    <form action="spotSendReport.php" class="inlightbox-form3" method="post" id="sendReportForm" enctype="multipart/form-data">
                        <input type="hidden" name="comNo" id="formComNo">
                        <ul>
                            <li><label><input id="pl" name="reason" value="0" type="radio">與色情相關</label></li>
                            <li><label ><input id="pl1" name="reason" value="1" type="radio">與本網站無相關</label></li>
                            <li><label><input id="pl2" name="reason" value="2" type="radio">言詞用語粗俗不檔</label></li>
                            <li><input class="submitbtn3" type="button" value="送出" id="sendReportBtn"></li>
                        </ul>
                    </form>
                </div>
            </div>

            <!-- 留言送出 串好後端 -->
            <div class="spotComBlock spotComSend" >
                <div id="spotComSend" style="width: 80px; height: 80px; display: inline-block;">

                    <!-- <img src="./img/spot/member/memPhoto_200x200-01.png" alt=""> -->
                </div>              

                <div class="spotComSendText" id="spotComSendText">
                    <form method="post" enctype="multipart/form-data">
                        <textarea name="message" id="message" rows="2" placeholder="我要留言" Wrap="Physical"></textarea>
                        <i id="sendBtn" class="fas fa-location-arrow fa-flip-horizontal"></i>
                    </form>
                </div>
            </div>
            <!-- 留言送出 串好後端 end -->
        </section>

    </main>


    <footer>
    <div class="copyright">
        Copyright © 2020 Divein | 海中日子 All Rights Reserved.
    </div>
</footer>
    <script src="./js/login.js"></script>
    <script src="./js/bubbleBtn.js"></script>
    <script src="./js/common.js"></script>
    <!-- <script src="./js/spotRefer.js"></script> -->

    <script src="./js/spotRefer.js"></script>
    <script src="./js/spotReferFuturAPI.js"></script>
    <script src="./js/spotReferWeatherAPI.js"></script>

    <script src="./js/spotHere.js"></script>
    <script src="./js/spotReferCom.js"></script>


    <script>
    function $id(id){
        return document.getElementById(id);
    }	
    let spotReferInfoRow;   //潛點照片 潛點敘述 動物照片    
    let html ="";
    var spotDiveNO;
    let spotReferMemRow;

    //－－－－－－潛點留言 若有登入的會員頭像
        function spotComMemImg (){
            let xhr = new XMLHttpRequest();
            xhr.onload = function(){
                spotReferMemRow = JSON.parse(xhr.responseText);  //把字串解析成json形式
                html ="";
                if(spotReferMemRow.memAvatar){ //長度不為0 {} 表示有會員樣式

                    html = `<img src="img/member/member/${spotReferMemRow.memAvatar}" data-memId="${spotReferMemRow.memId}" alt=""></img>`;
                    $id("spotComSend").innerHTML = html;
                }else{
                    html = `<img src="./img/member/member/memDefault.png">`;
                    $id("spotComSend").innerHTML = html;
                }
            }

            xhr.open("get", "./postMemberInfo.php", false);
            xhr.send(null);
            getSpotComs();
            
        }


    //－－－－－－潛點照片
        function showSpotReferImg(){
            html = `<img src="./img/spot/${spotReferInfoRow[0].picture}" alt="">`;
            $id("spotReferImg").innerHTML = html;
            $id("spotReferImg_rwd").innerHTML = html;
            let numImg_1;
            let numImg_2;
            for(var i=1; i <= 100; i++){
                numImg_1 = Math.floor(Math.random() * (23 - 1 + 1)) + 01;
                numImg_2 = Math.floor(Math.random() * (23 - 1 + 1)) + 01;
            }

            let showSmallPic = `
                                <img src="./img/spot/${spotReferInfoRow[0].picture}" alt="">
                                <img src="./img/spot/spotPic-${numImg_1}.png" alt="">
                                <img src="./img/spot/spotPic-${numImg_2}.png" alt="">
                            `;
                            console.log(numImg_1);
                            console.log(numImg_2);
            $id("spotReferSmallImg").innerHTML = showSmallPic;
            $id("spotReferSmallImg_rwd").innerHTML = showSmallPic;
            clickPicChange();
            clickPicChangeRwd();

        }


        function showLarge(e){
            let srcImg = e.target;
            let newImg = srcImg.cloneNode();
            let spotReferImg = document.getElementById("spotReferImg");
            spotReferImg.replaceChild(newImg, spotReferImg.firstElementChild);

        }

        function clickPicChange(){
            var imgs = document.querySelectorAll(".spotReferSmallImg img");
            for( let i = 0; i<imgs.length; i++){
                imgs[i].onclick = showLarge;
            }
        }
        //rwd版本
        function showLargeRwd(e){
            let srcImg = e.target;
            let newImg = srcImg.cloneNode();
            let spotReferImg_rwd = document.getElementById("spotReferImg_rwd");
            spotReferImg_rwd.replaceChild(newImg, spotReferImg_rwd.firstElementChild);

        }

        function clickPicChangeRwd(){
            var imgs = document.querySelectorAll(".spotReferSmallImg_rwd img");
            for( let i = 0; i<imgs.length; i++){
                imgs[i].onclick = showLargeRwd;
            }
        }


    //－－－－－－潛點標題介紹
        function showSpotTitel(){
            let spotTitel =`
                <h3 data-geocode="${spotReferInfoRow[0].geocode}" 
                    data-spotStationIdSea="${spotReferInfoRow[0].spotStationId_sea}" 
                    data-spotStationId="${spotReferInfoRow[0].spotStationId}" >
                    ${spotReferInfoRow[0].diveAreaName}-${spotReferInfoRow[0].diveName}
                </h3>`;

            $(spotTitel).insertBefore('#spotReferIntor');
            $(spotTitel).insertBefore('#spotReferImg_rwd');

            var spotStationId_sea = document.querySelector('.spotRefer_weather >h3').getAttribute('data-spotstationidsea');
            
            var spotgecode = document.querySelector('.spotRefer_weather >h3').getAttribute('data-geocode');

            var spotStationId = document.querySelector('.spotRefer_weather >h3').getAttribute('data-spotStationId');

            getSpotReferWeatherAPI();
        }

    //－－－－－－潛點介紹內文
        function showInfotext(){
            // let spotReferIntor = $id("spotReferIntor"); 
            // let spotReferIntor_rwd = $id("spotReferIntor_rwd");
            html = `<p>${spotReferInfoRow[0].description}</p>`;
            $id("spotReferIntor").innerHTML = html;
            $id("spotReferIntor_rwd").innerHTML = html;
        }
    
    //－－－－－－show 動物照片
        function showAnimals(){
            let showAnimalRows = $id("showAnimalRows"); 
            for(let i=0; i< spotReferInfoRow.length; i++){
                html +=`<img src="./img/animals/${spotReferInfoRow[i].animalPic}" alt="">`;
            }
            showAnimalRows.innerHTML = html;
        }

    //－－－－－－取得資料庫潛點基本資訊
        function spotGetReferInfor(){
            let xhr = new XMLHttpRequest();
            xhr.onload = function(){
                spotReferInfoRow = JSON.parse(xhr.responseText);  //把字串解析成json形式
                
                showSpotReferImg();
                showSpotTitel();
                showInfotext();
                showAnimals();

            }
            xhr.open("get", `./spotGetReferInfor.php?spotDiveNO=${spotDiveNO}`, false);
            xhr.send(null);
        }

    //－－－－－－取得頁面數值
        function spotGetUrl(){
            let url = location.href;
            let thisURL = url.split("?");
            let DIVENO = thisURL[1].split("-");
            for (let i = 0; i < DIVENO.length; i++) {
                spotDiveNO = DIVENO[i];
            }
            console.log(spotDiveNO);

            sessionStorage["where"] = `./spotRefer.html?diveNo-${spotDiveNO}`;
            
            //要先做的事情 取得從哪邊來的數值spotDiveNO
            //讀取留言｜讀取來過這邊的人數

            spotComMemImg();
            getSpotPep(spotDiveNO);
            spotGetReferInfor();
            spotHereInit();
        }
    
    
        window.addEventListener("load", function(){

            spotGetUrl();
            //頁籤監聽事件|天氣
            var weathers = document.getElementsByClassName('weathers');
            for(var i=0;i<weathers.length;i++){
                weathers[i].onclick = function(){
                    getSpotReferFuturAPI()
                    getSpotReferWeatherAPI();
                }
            }

        },false);

    </script>

    <script>
        var storage = sessionStorage;
        let itemString = storage.getItem('addItemList'); //給key值，傳回value
        // alert(itemString); "A1001, A1005, A1006, A1002";
        // substr 返回擷取的字串，四個分隔號會分割成五個值的陣列，故最後的分隔號不計算，就可避免多一個空值
        // [A1001,A1005,A1006,A1002]
        let itemCounting = document.getElementById('itemCounting');

        if (storage['addItemList'] == null | storage['addItemList'] == '') {
            itemCounting.style.display = "none";
        } else {
            let items = itemString.substr(0, itemString.length - 2).split(', ');
            itemCounting.style.display = "block";
            itemCounting.style.backgroundColor = "red";
            itemCounting.innerText = items.length;
        }

    </script>


</body>
</html>
